<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Alfabetik FSP A–Z</title>

  <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />

  <style>
    :root{
      --border:#e9e9e9;
      --muted:#6b6b6b;
      --bg:#ffffff;
      --hover:#f7f7f7;
      --active:#e8f3ff;
      --shadow: 0 12px 30px rgba(0,0,0,.12);
    }

    body{
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 18px;
      max-width: 980px;
      color:#111;
      background: var(--bg);
    }

    h1{
      font-size: 1.55rem;
      margin-bottom: 12px;
      font-weight: 650;
    }

    .topbar{
      display:flex;
      gap:12px;
      margin-bottom: 8px;
      flex-wrap: wrap;
    }

    #search{
      flex: 1;
      padding: 10px 12px;
      border: 1px solid #d8d8d8;
      border-radius: 14px;
      font-size: 1rem;
    }

    #resetBtn{
      padding: 10px 16px;
      border: 1px solid #d8d8d8;
      border-radius: 14px;
      background: white;
      cursor: pointer;
    }

    #meta{
      color: var(--muted);
      font-size: .95rem;
      margin: 6px 0 12px 2px;
    }

    .headerRow, .itemRow{
      display: grid;
      grid-template-columns: 1fr 180px;
      align-items: center;
      gap: 10px;
    }

    .headerRow{
      padding: 8px;
      border-top: 1px solid var(--border);
      border-bottom: 1px solid var(--border);
      color: var(--muted);
      font-size: .92rem;
    }

    .itemRow{
      padding: 8px;
      border-bottom: 1px solid #f2f2f2;
      cursor: pointer;
    }

    .itemRow:hover{ background: var(--hover); }
    .itemRow.active{ background: var(--active); }

    .title{
      font-size: 1.02rem;
      font-weight: 500;
    }

    .actions{
      display:flex;
      justify-content:flex-end;
      gap:10px;
    }

    .iconBtn{
      width: 38px;
      height: 38px;
      border-radius: 999px;
      border: 1px solid #d8d8d8;
      background: white;
      display:flex;
      align-items:center;
      justify-content:center;
      cursor: pointer;
    }
    .iconBtn.on{
      border-color: #2b7cff;
      box-shadow: 0 0 0 3px rgba(43,124,255,.12) inset;
    }

    #floatingPlayer{
      position: fixed;
      left: 18px;
      bottom: 18px;
      width: min(720px, calc(100vw - 36px));
      background: white;
      border: 1px solid #e0e0e0;
      border-radius: 18px;
      box-shadow: var(--shadow);
      z-index: 9999;
    }

    #fpHeader{
      padding: 10px 12px;
      border-bottom: 1px solid #f0f0f0;
      background: #fbfbfb;
      cursor: grab;
      font-weight: 600;
    }

    #fpBody{ padding: 10px 12px; }
  </style>
</head>

<body>

<h1>Alfabetik FSP A–Z</h1>

<div class="topbar">
  <input id="search" placeholder="Arama..." />
  <button id="resetBtn">Hepsi</button>
</div>

<div id="meta"></div>

<div class="headerRow">
  <div>Kayıt</div>
  <div style="text-align:right">İşlemler</div>
</div>

<div id="list"></div>

<div id="floatingPlayer">
  <div id="fpHeader">Bir kayıt seç…</div>
  <div id="fpBody">
    <audio id="player" controls preload="metadata"></audio>
  </div>
</div>

<script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>

<script>
const BASE = "https://archive.org/download/vorhofflimmern-bei-bekannter-khk-dr-oemer-dr-remzi-09.05.25/";
const listEl = document.getElementById("list");
const searchEl = document.getElementById("search");
const metaEl = document.getElementById("meta");
const fpTitle = document.getElementById("fpHeader");
const playerEl = document.getElementById("player");

const plyr = new Plyr(playerEl);

const LS = {
  favs: "fsp.favs.v1",
  sels: "fsp.sels.v1"
};

const favs = JSON.parse(localStorage.getItem(LS.favs) || "{}");
const sels = JSON.parse(localStorage.getItem(LS.sels) || "{}");

let items = [];
let activeId = null;

const normTR = s => (s||"").toLocaleLowerCase("tr");

const guessMime = url => {
  const p = new URL(url).pathname.toLowerCase();
  if (p.endsWith(".mp3")) return "audio/mpeg";
  if (p.endsWith(".m4a")) return "audio/mp4";
  return "audio/*";
};

const urlFor = it => new URL(it.file, BASE).toString();

async function loadItems(){
  const res = await fetch(`items.json?v=${Date.now()}`);
  items = await res.json();
  render();
}

function getVisible(){
  const q = normTR(searchEl.value);
  return items.filter(i => !q || normTR(i.title).includes(q));
}

function render(){
  const visible = getVisible();
  metaEl.textContent = `Görünən: ${visible.length} / Toplam: ${items.length}`;
  listEl.innerHTML = "";

  for(const it of visible){
    const row = document.createElement("div");
    row.className = "itemRow" + (it.id===activeId?" active":"");

    row.innerHTML = `
      <div class="title">${it.title}</div>
      <div class="actions">
        <button class="iconBtn ${favs[it.id]?"on":""}">⭐</button>
        <button class="iconBtn ${sels[it.id]?"on":""}">✓</button>
      </div>
    `;

    const [favBtn, selBtn] = row.querySelectorAll("button");

    favBtn.onclick = e => {
      e.stopPropagation();
      favs[it.id] = !favs[it.id];
      localStorage.setItem(LS.favs, JSON.stringify(favs));
      render();
    };

    selBtn.onclick = e => {
      e.stopPropagation();
      sels[it.id] = !sels[it.id];
      localStorage.setItem(LS.sels, JSON.stringify(sels));
      render();
    };

    row.onclick = () => {
      activeId = it.id;
      fpTitle.textContent = it.title;
      plyr.source = {
        type: "audio",
        sources: [{ src: urlFor(it), type: guessMime(urlFor(it)) }]
      };
      plyr.play();
      render();
    };

    listEl.appendChild(row);
  }
}

searchEl.oninput = render;
document.getElementById("resetBtn").onclick = () => { searchEl.value=""; render(); };

loadItems();
</script>

</body>
</html>
