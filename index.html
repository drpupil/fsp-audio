<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Alfabetik FSP A–Z</title>

<link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css"/>

<style>
body{
  margin:0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
  background:#fff;
  color:#111;
  font-weight:400;
}

.container{
  max-width:1100px;
  margin:24px auto 140px;
  padding:0 16px;
}

h1{
  font-size:56px;
  margin:0 0 16px;
}

input{
  width:100%;
  padding:14px 16px;
  font-size:18px;
  border-radius:16px;
  border:1px solid #ddd;
}

.meta{
  margin:12px 0;
  color:#666;
  font-size:16px;
}

.list{
  border-top:1px solid #e5e7eb;
}

.row{
  padding:12px 8px;
  border-bottom:1px solid #e5e7eb;
  cursor:pointer;
}

.row:hover{
  background:#f1f5f9;
}

.row.active{
  background:#e0f2fe;
}

.title{
  font-size:20px;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

#floatingPlayer{
  position:fixed;
  left:16px;
  bottom:16px;
  width:min(760px,calc(100vw - 32px));
  background:#fff;
  border:1px solid #ddd;
  border-radius:16px;
  box-shadow:0 10px 30px rgba(0,0,0,.15);
  z-index:9999;
}

#fpHeader{
  padding:10px 14px;
  border-bottom:1px solid #e5e7eb;
  font-size:16px;
  font-weight:600;
  cursor:grab;
}

#fpHeader:active{
  cursor:grabbing;
}

#playerWrap{
  padding:12px;
}

.plyr *{
  font-weight:400 !important;
}
</style>
</head>

<body>

<div class="container">
  <h1>Alfabetik FSP A–Z</h1>
  <input id="search" placeholder="Arama (ör. ACS, DM, PAVK)...">
  <div id="meta" class="meta">Yükleniyor…</div>
  <div id="rows" class="list"></div>
</div>

<div id="floatingPlayer">
  <div id="fpHeader">Bir kayıt seç…</div>
  <div id="playerWrap">
    <audio id="player" controls preload="metadata"></audio>
  </div>
</div>

<script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>

<script>
/* ====== AYAR ====== */
const ARCHIVE_IDENTIFIER = "fsp-audio"; // ← BURAYI DOĞRU YAP
const ITEMS_JSON = "./items.json";
const BASE = `https://archive.org/download/${ARCHIVE_IDENTIFIER}/`;

const rowsEl = document.getElementById("rows");
const metaEl = document.getElementById("meta");
const searchEl = document.getElementById("search");
const fpHeader = document.getElementById("fpHeader");
const audio = document.getElementById("player");

const plyr = new Plyr(audio,{
  seekTime:5,
  settings:["speed"],
  speed:{selected:1,options:[0.8,0.9,1,1.1,1.2]}
});

let allItems=[];
let viewItems=[];
let activeIndex=-1;

function buildUrl(file){
  return BASE + encodeURIComponent(file).replace(/%2F/g,"/");
}

function render(){
  rowsEl.innerHTML="";
  viewItems.forEach((it,i)=>{
    const row=document.createElement("div");
    row.className="row"+(i===activeIndex?" active":"");
    row.innerHTML=`<div class="title">${it.title}</div>`;
    row.onclick=()=>playIndex(i,true);
    rowsEl.appendChild(row);
  });
  metaEl.textContent=`Görünen: ${viewItems.length} / Toplam: ${allItems.length}`;
}

async function playIndex(i,user){
  activeIndex=i;
  const it=viewItems[i];
  fpHeader.textContent=it.title;
  audio.src=buildUrl(it.file);
  audio.load();
  render();
  if(user){
    try{ await plyr.play(); }catch{}
  }
}

searchEl.oninput=()=>{
  const q=searchEl.value.toLowerCase();
  viewItems=allItems.filter(i=>i.title.toLowerCase().includes(q));
  activeIndex=-1;
  render();
};

async function load(){
  const r=await fetch(ITEMS_JSON,{cache:"no-store"});
  const data=await r.json();
  allItems=data
    .filter(x=>x.file.endsWith(".m4a")||x.file.endsWith(".mp3"))
    .sort((a,b)=>a.title.localeCompare(b.title,"tr"));
  viewItems=[...allItems];
  render();
}

load();

/* sürükleme */
(()=>{
  let sx,sy,l,b,drag=false;
  fpHeader.onpointerdown=e=>{
    drag=true;
    sx=e.clientX; sy=e.clientY;
    const r=floatingPlayer.getBoundingClientRect();
    l=r.left; b=innerHeight-r.bottom;
  };
  onpointermove=e=>{
    if(!drag)return;
    floatingPlayer.style.left=l+(e.clientX-sx)+"px";
    floatingPlayer.style.bottom=b-(e.clientY-sy)+"px";
  };
  onpointerup=()=>drag=false;
})();
</script>

</body>
</html>
