<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Alfabetik FSP A‚ÄìZ</title>

  <link rel="preconnect" href="https://cdn.plyr.io" />
  <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />

  <style>
    :root{
      --border:#e9e9e9;
      --text:#111;
      --muted:#666;
      --accent:#2563eb;
      --bg:#fff;
      --rowH: 52px;           /* satƒ±r y√ºksekliƒüi (dar) */
      --iconBtn: 34px;        /* ikon buton √ßapƒ± */
      --radius: 14px;
      --shadow: 0 10px 35px rgba(0,0,0,.08);
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      background:var(--bg);
    }
    .wrap{
      max-width: 1220px;
      margin: 22px auto 110px; /* player i√ßin altta bo≈üluk */
      padding: 0 16px;
    }
    h1{
      margin: 0 0 14px;
      font-weight: 800;
      letter-spacing: -.02em;
    }

    /* Top bar */
    .topbar{
      display:flex;
      gap:12px;
      align-items:center;
      flex-wrap:wrap;
      margin: 10px 0 10px;
    }
    .search{
      flex: 1 1 520px;
      min-width: 240px;
      height: 48px;
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 0 16px;
      font-size: 18px;
      outline:none;
    }
    .btn{
      height: 48px;
      padding: 0 18px;
      border: 1px solid #cfd8ea;
      border-radius: 16px;
      background:#fff;
      color: var(--accent);
      font-weight: 700;
      cursor:pointer;
    }
    .counts{
      margin: 0 0 10px;
      color: var(--muted);
      font-size: 16px;
    }

    /* Table-like layout using CSS grid */
    .list{
      border-top: 1px solid var(--border);
    }

    /* columns: title | dur | likeCount | like | fav | sel | download */
    .row, .head{
      display:grid;
      grid-template-columns: 1fr 72px 36px 44px 44px 44px 44px;
      align-items:center;
      column-gap: 10px;
      height: var(--rowH);
      border-bottom: 1px solid var(--border);
    }
    .head{
      color: var(--muted);
      font-size: 14px;
      user-select:none;
    }
    .cell-title{
      min-width: 0;
      padding-right: 6px;
    }
    .title{
      font-size: 20px;
      line-height: 1.1;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }
    .row{
      cursor:pointer;
    }
    .row:hover{
      background: #f6f9ff;
    }
    .row.active{
      background: #e8f1ff;
    }

    .dur{
      text-align:right;
      font-variant-numeric: tabular-nums;
      color: #333;
      font-size: 14px;
    }
    .likeCount{
      text-align:right;
      color:#333;
      font-variant-numeric: tabular-nums;
      font-size: 14px;
    }

    .iconBtn{
      width: var(--iconBtn);
      height: var(--iconBtn);
      border-radius: 999px;
      border: 1px solid #d8d8d8;
      display:grid;
      place-items:center;
      background:#fff;
      cursor:pointer;
      user-select:none;
    }
    .iconBtn svg{
      width: 18px;
      height: 18px;
      display:block;
    }
    .iconBtn:hover{ border-color:#bdbdbd; }
    .iconBtn.on{
      border-color: #94b2ff;
      box-shadow: 0 0 0 3px rgba(37,99,235,.12);
    }
    .iconBtn.like.on{ color:#e11d48; }
    .iconBtn.fav.on{ color:#f59e0b; }
    .iconBtn.sel.on{ color:#2563eb; }
    .iconBtn.dl{ color:#111; }

    .head .iconBtn{
      opacity:.45;
    }
    .head .iconBtn.filterOn{
      opacity: 1;
      border-color:#94b2ff;
      box-shadow: 0 0 0 3px rgba(37,99,235,.12);
    }

    /* Player (floating, draggable) */
    #floatingPlayer{
      position: fixed;
      left: 50%;
      bottom: 14px;
      transform: translateX(-50%);
      width: min(980px, calc(100% - 24px));
      background: #fff;
      border: 1px solid var(--border);
      border-radius: 18px;
      box-shadow: var(--shadow);
      overflow:hidden;
      z-index: 999;
      touch-action: none;
    }
    .fpHeader{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 12px;
      padding: 10px 12px;
      border-bottom:1px solid var(--border);
      cursor: grab;
    }
    .fpHeader:active{ cursor:grabbing; }
    #fpTitle{
      font-weight: 700;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
      max-width: 70%;
    }
    .fpRight{
      display:flex;
      gap: 10px;
      align-items:center;
      color: var(--muted);
      font-size: 13px;
      user-select:none;
    }
    .miniBtn{
      width: 40px;
      height: 34px;
      border-radius: 12px;
      border: 1px solid #d8d8d8;
      background:#fff;
      cursor:pointer;
      display:grid;
      place-items:center;
      user-select:none;
    }
    .miniBtn:hover{ border-color:#bdbdbd; }
    .miniBtn svg{ width:18px;height:18px; }

    .fpBody{
      padding: 10px 12px 12px;
    }
    #status{
      color: var(--muted);
      font-size: 14px;
      margin: 0 0 6px;
      min-height: 18px;
    }

    /* Make Plyr a bit more compact */
    .plyr--audio .plyr__controls{
      padding: 8px 10px !important;
    }
    .plyr__time{ font-variant-numeric: tabular-nums; }

    /* Mobile tweaks */
    @media (max-width: 720px){
      :root{ --rowH: 56px; }
      .row, .head{
        grid-template-columns: 1fr 54px 28px 40px 40px 40px 40px;
      }
      .title{ font-size: 18px; }
      .search{ font-size: 17px; }
      .counts{ font-size: 15px; }
      #fpTitle{ max-width: 58%; }
    }

    /* Very small screens: hide duration column text if needed */
    @media (max-width: 420px){
      .row, .head{
        grid-template-columns: 1fr 0px 28px 38px 38px 38px 38px;
      }
      .dur{ display:none; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <h1>Alfabetik FSP A‚ÄìZ</h1>

    <div class="topbar">
      <input id="search" class="search" placeholder="Arama (√∂r. ACS, DM, PAVK)..." />
      <button id="clearAll" class="btn">Hepsi</button>
    </div>

    <div class="counts" id="counts">Y√ºkleniyor‚Ä¶</div>

    <div class="list" id="list">
      <!-- header -->
      <div class="head" id="head">
        <div class="cell-title">Kayƒ±t</div>
        <div class="dur"></div>
        <div></div>

        <!-- header filters -->
        <div class="iconBtn like" id="filterLike" title="Liked filtre">
          <!-- heart -->
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 21s-7-4.35-9.5-8.28C.5 9.4 2.2 6.5 5.4 6.5c1.8 0 3.1 1 3.9 2 0 0 .9-2 3.8-2 3.2 0 4.9 2.9 2.9 6.22C19 16.65 12 21 12 21z"/>
          </svg>
        </div>

        <div class="iconBtn fav" id="filterFav" title="Favori filtre">
          <!-- star -->
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 17.3l-6.2 3.3 1.2-7-5-4.9 7-1L12 1.5l3 6.2 7 1-5 4.9 1.2 7z"/>
          </svg>
        </div>

        <div class="iconBtn sel" id="filterSel" title="Se√ßili filtre">
          <!-- check -->
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20 6L9 17l-5-5"/>
          </svg>
        </div>

        <div></div>
      </div>

      <div id="rows"></div>
    </div>
  </div>

  <!-- Floating player -->
  <div id="floatingPlayer" aria-label="Player">
    <div class="fpHeader" id="fpDrag">
      <div id="fpTitle">Bir kayƒ±t se√ß‚Ä¶</div>

      <div class="fpRight">
        <button class="miniBtn" id="prevBtn" title="√ñnceki">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M11 19l-9-7 9-7v14z"/><path d="M22 19V5"/>
          </svg>
        </button>
        <button class="miniBtn" id="nextBtn" title="Sonraki">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M13 5l9 7-9 7V5z"/><path d="M2 5v14"/>
          </svg>
        </button>
        <span>üîÅ S√ºr√ºkle</span>
      </div>
    </div>

    <div class="fpBody">
      <div id="status"></div>
      <audio id="player" class="js-player" controls preload="metadata"></audio>
    </div>
  </div>

  <script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>

  <script>
    // ---------- Utils ----------
    const qs = (s, el=document) => el.querySelector(s);
    const qsa = (s, el=document) => Array.from(el.querySelectorAll(s));

    const fmtTime = (sec) => {
      if (!isFinite(sec) || sec <= 0) return "";
      sec = Math.floor(sec);
      const m = Math.floor(sec/60);
      const s = sec % 60;
      return String(m).padStart(2,"0") + ":" + String(s).padStart(2,"0");
    };

    const extOk = (url) => {
      const u = String(url || "").toLowerCase();
      return /\.m4a(\?|#|$)/i.test(u) || /\.mp3(\?|#|$)/i.test(u);
    };

    const makeDownloadUrl = (url) => {
      // archive.org i√ßin download=1 genelde indirmeyi tetikliyor
      try{
        const u = new URL(url, location.href);
        if (!u.searchParams.has("download")) u.searchParams.set("download", "1");
        return u.toString();
      }catch{
        if (String(url).includes("?")) return url + "&download=1";
        return url + "?download=1";
      }
    };

    // ---------- Storage ----------
    const LS = {
      get(key, fallback){
        try{
          const v = localStorage.getItem(key);
          return v ? JSON.parse(v) : fallback;
        }catch{ return fallback; }
      },
      set(key, val){
        try{ localStorage.setItem(key, JSON.stringify(val)); }catch{}
      }
    };

    // State
    let items = [];
    let view = [];                 // current rendered list (after filters + search)
    let currentIndex = -1;         // index in view
    let filter = { like:false, fav:false, sel:false };

    // user state stored per item url
    let st = LS.get("fsp_state_v1", { liked:{}, fav:{}, sel:{}, likeCount:{}, dur:{} });

    // Elements
    const searchEl = qs("#search");
    const rowsEl = qs("#rows");
    const countsEl = qs("#counts");
    const statusEl = qs("#status");

    // Header filter buttons
    const filterLikeEl = qs("#filterLike");
    const filterFavEl  = qs("#filterFav");
    const filterSelEl  = qs("#filterSel");

    // Player
    const audioEl = qs("#player");
    audioEl.crossOrigin = "anonymous";
    const fpTitleEl = qs("#fpTitle");
    const prevBtn = qs("#prevBtn");
    const nextBtn = qs("#nextBtn");

    // Plyr init
    const plyr = new Plyr(audioEl, {
      seekTime: 5,
      controls: [
        "rewind","play","fast-forward",
        "progress","current-time","duration",
        "mute","volume","settings"
      ],
      settings: ["speed"],
      speed: { selected: 1, options: [0.8, 0.9, 1, 1.1, 1.2] }
    });

    // ---------- Load items ----------
    async function loadItems(){
      statusEl.textContent = "Liste y√ºkleniyor‚Ä¶";
      const res = await fetch("./items.json", { cache: "no-store" });
      const data = await res.json();

      // items.json: Array veya {items:[...]} olabilir
      const arr = Array.isArray(data) ? data : (Array.isArray(data.items) ? data.items : []);

      items = arr
        .filter(x => x && (x.url || x.href) && (x.title || x.name))
        .map(x => {
          const url = x.url || x.href;
          const title = x.title || x.name;
          return { title, url, titleLower: String(title).toLowerCase() };
        })
        .filter(x => extOk(x.url))
        .sort((a,b)=>a.titleLower.localeCompare(b.titleLower, "tr"));

      statusEl.textContent = items.length ? "" : "items.json geldi ama uygun .m4a/.mp3 bulunamadƒ±.";
      render();
      prefetchDurations(); // arka planda metadata yakalamaya √ßalƒ±≈üƒ±r
    }

    // ---------- Duration metadata ----------
    const durQueue = new Set();
    let durWorkerRunning = false;

    function prefetchDurations(){
      // sadece g√∂r√ºnene deƒüil, hepsine sƒ±rayla; ama cache varsa ge√ß
      items.forEach(it=>{
        if (!st.dur[it.url] && !durQueue.has(it.url)) durQueue.add(it.url);
      });
      if (!durWorkerRunning) durWorker();
    }

    async function durWorker(){
      durWorkerRunning = true;
      while(durQueue.size){
        const url = durQueue.values().next().value;
        durQueue.delete(url);

        // metadata √ßek
        try{
          const d = await getDuration(url);
          if (isFinite(d) && d > 0){
            st.dur[url] = d;
            LS.set("fsp_state_v1", st);
            // ekranda varsa g√ºncelle
            const cell = qs(`[data-dur-for="${cssEscape(url)}"]`);
            if (cell) cell.textContent = fmtTime(d);
          }
        }catch{
          // CORS olursa sessiz ge√ß
        }
        // k√º√ß√ºk nefes
        await new Promise(r=>setTimeout(r, 40));
      }
      durWorkerRunning = false;
    }

    function getDuration(url){
      return new Promise((resolve, reject)=>{
        const a = new Audio();
        a.preload = "metadata";
        a.crossOrigin = "anonymous";
        a.src = url;
        const cleanup = () => {
          a.removeEventListener("loadedmetadata", onOk);
          a.removeEventListener("error", onErr);
          a.src = "";
        };
        const onOk = () => { const d = a.duration; cleanup(); resolve(d); };
        const onErr = () => { cleanup(); reject(new Error("metadata error")); };
        a.addEventListener("loadedmetadata", onOk, { once:true });
        a.addEventListener("error", onErr, { once:true });
      });
    }

    // ---------- Render ----------
    function render(){
      const q = searchEl.value.trim().toLowerCase();

      view = items.filter(it=>{
        if (q && !it.titleLower.includes(q)) return false;
        if (filter.like && !st.liked[it.url]) return false;
        if (filter.fav  && !st.fav[it.url]) return false;
        if (filter.sel  && !st.sel[it.url]) return false;
        return true;
      });

      countsEl.textContent = `G√∂r√ºnen: ${view.length} / Toplam: ${items.length}`;
      rowsEl.innerHTML = "";

      view.forEach((it, idx)=>{
        const row = document.createElement("div");
        row.className = "row" + (idx === currentIndex ? " active" : "");
        row.dataset.url = it.url;

        const durTxt = st.dur[it.url] ? fmtTime(st.dur[it.url]) : "";

        row.innerHTML = `
          <div class="cell-title"><div class="title" title="${escapeHtml(it.title)}">${escapeHtml(it.title)}</div></div>
          <div class="dur" data-dur-for="${escapeHtml(it.url)}">${durTxt}</div>
          <div class="likeCount">${Number(st.likeCount[it.url]||0)}</div>

          <div class="iconBtn like ${st.liked[it.url] ? "on" : ""}" data-act="like" title="Like">
            ${heartSvg()}
          </div>
          <div class="iconBtn fav ${st.fav[it.url] ? "on" : ""}" data-act="fav" title="Favori">
            ${starSvg()}
          </div>
          <div class="iconBtn sel ${st.sel[it.url] ? "on" : ""}" data-act="sel" title="Se√ß">
            ${checkSvg()}
          </div>

          <a class="iconBtn dl" data-act="dl" title="ƒ∞ndir" href="${escapeAttr(makeDownloadUrl(it.url))}" download rel="noopener">
            ${downloadSvg()}
          </a>
        `;

        // Row click plays (but not auto-play due to iOS policies)
        row.addEventListener("click", (e)=>{
          const act = e.target?.closest?.("[data-act]")?.dataset?.act;

          // if clicked one of the buttons, handle action and don't trigger play
          if (act){
            e.preventDefault();
            e.stopPropagation();
            if (act === "dl"){
              // let anchor do its thing (download attribute)
              return;
            }
            if (act === "like") toggleLike(it, row);
            if (act === "fav")  toggleFav(it, row);
            if (act === "sel")  toggleSel(it, row);
            return;
          }

          playIndex(idx);
        });

        rowsEl.appendChild(row);
      });

      // update header filter visual
      setHeaderFilterVisual();
    }

    function setHeaderFilterVisual(){
      filterLikeEl.classList.toggle("filterOn", filter.like);
      filterFavEl.classList.toggle("filterOn", filter.fav);
      filterSelEl.classList.toggle("filterOn", filter.sel);
    }

    // ---------- Actions ----------
    function toggleLike(it, row){
      const on = !st.liked[it.url];
      st.liked[it.url] = on;

      // local like counter
      const c = Number(st.likeCount[it.url]||0);
      st.likeCount[it.url] = on ? c+1 : Math.max(0, c-1);

      LS.set("fsp_state_v1", st);

      // UI
      row.querySelector('[data-act="like"]').classList.toggle("on", on);
      row.querySelector(".likeCount").textContent = st.likeCount[it.url];

      // if filter active, re-render
      if (filter.like && !on) render();
    }

    function toggleFav(it, row){
      const on = !st.fav[it.url];
      st.fav[it.url] = on;
      LS.set("fsp_state_v1", st);
      row.querySelector('[data-act="fav"]').classList.toggle("on", on);
      if (filter.fav && !on) render();
    }

    function toggleSel(it, row){
      const on = !st.sel[it.url];
      st.sel[it.url] = on;
      LS.set("fsp_state_v1", st);
      row.querySelector('[data-act="sel"]').classList.toggle("on", on);
      if (filter.sel && !on) render();
    }

    // ---------- Player ----------
    function playIndex(idx){
      if (idx < 0 || idx >= view.length) return;
      currentIndex = idx;
      const it = view[idx];

      // highlight
      qsa(".row").forEach(r=>r.classList.remove("active"));
      const activeRow = qs(`.row[data-url="${cssEscape(it.url)}"]`);
      if (activeRow) activeRow.classList.add("active");

      fpTitleEl.textContent = it.title;

      // set source
      statusEl.innerHTML = "";
      plyr.source = {
        type: "audio",
        title: it.title,
        sources: [{ src: it.url, type: guessMime(it.url) }]
      };

      // Don't auto-play (mobile restriction). Just load and show hint.
      plyr.pause();
      // plyr.play() only after user gesture; row click is a gesture, but iOS still can block sometimes.
      // We'll try, if blocked show message.
      tryPlayWithHint(it.url);

      updatePrevNextDisabled();
    }

    async function tryPlayWithHint(url){
      try{
        await plyr.play();
        statusEl.textContent = "";
      }catch{
        // show direct-open link as fallback
        statusEl.innerHTML = `Oynatma ba≈ülatƒ±lamadƒ±. Player‚Äôdaki ‚ñ∂ tu≈üuna bas. <a href="${escapeAttr(url)}" target="_blank" rel="noopener">dosyayƒ± yeni sekmede a√ß</a>`;
      }
    }

    function updatePrevNextDisabled(){
      prevBtn.disabled = (currentIndex <= 0);
      nextBtn.disabled = (currentIndex >= view.length-1);
      prevBtn.style.opacity = prevBtn.disabled ? .35 : 1;
      nextBtn.style.opacity = nextBtn.disabled ? .35 : 1;
    }

    prevBtn.addEventListener("click", ()=>{
      if (currentIndex > 0) playIndex(currentIndex-1);
    });
    nextBtn.addEventListener("click", ()=>{
      if (currentIndex < view.length-1) playIndex(currentIndex+1);
    });

    // keyboard: space toggles play/pause (except while typing)
    document.addEventListener("keydown", (e)=>{
      const tag = (e.target && e.target.tagName) ? e.target.tagName.toLowerCase() : "";
      if (tag === "input" || tag === "textarea") return;
      if (e.code === "Space"){
        e.preventDefault();
        plyr.togglePlay();
      }
    });

    // ---------- Filters ----------
    filterLikeEl.addEventListener("click", ()=>{
      filter.like = !filter.like;
      render();
    });
    filterFavEl.addEventListener("click", ()=>{
      filter.fav = !filter.fav;
      render();
    });
    filterSelEl.addEventListener("click", ()=>{
      filter.sel = !filter.sel;
      render();
    });

    // Clear all
    qs("#clearAll").addEventListener("click", ()=>{
      filter = { like:false, fav:false, sel:false };
      searchEl.value = "";
      render();
    });

    // Search
    searchEl.addEventListener("input", ()=>{
      render();
    });

    // ---------- Draggable floating player ----------
    (function makeDraggable(){
      const box = qs("#floatingPlayer");
      const handle = qs("#fpDrag");

      let dragging = false;
      let startX = 0, startY = 0;
      let startLeft = 0, startTop = 0;
      let pos = LS.get("fsp_player_pos_v1", null);

      function applyPos(p){
        // position using left/top when dragged; default is bottom centered
        if (!p){
          box.style.left = "50%";
          box.style.top = "";
          box.style.bottom = "14px";
          box.style.transform = "translateX(-50%)";
          return;
        }
        box.style.left = p.left + "px";
        box.style.top = p.top + "px";
        box.style.bottom = "auto";
        box.style.transform = "none";
      }

      // restore
      if (pos) applyPos(pos);

      const onDown = (ev)=>{
        const e = ev.touches ? ev.touches[0] : ev;
        dragging = true;

        const rect = box.getBoundingClientRect();
        startX = e.clientX;
        startY = e.clientY;
        startLeft = rect.left;
        startTop = rect.top;

        // switch to left/top mode
        box.style.transform = "none";
        box.style.bottom = "auto";
        box.style.left = rect.left + "px";
        box.style.top = rect.top + "px";

        ev.preventDefault();
      };

      const onMove = (ev)=>{
        if (!dragging) return;
        const e = ev.touches ? ev.touches[0] : ev;
        const dx = e.clientX - startX;
        const dy = e.clientY - startY;

        let left = startLeft + dx;
        let top  = startTop + dy;

        // clamp to viewport
        const vw = window.innerWidth;
        const vh = window.innerHeight;
        const rect = box.getBoundingClientRect();
        const w = rect.width;
        const h = rect.height;

        left = Math.max(8, Math.min(vw - w - 8, left));
        top  = Math.max(8, Math.min(vh - h - 8, top));

        box.style.left = left + "px";
        box.style.top  = top + "px";
      };

      const onUp = ()=>{
        if (!dragging) return;
        dragging = false;
        const rect = box.getBoundingClientRect();
        LS.set("fsp_player_pos_v1", { left: Math.round(rect.left), top: Math.round(rect.top) });
      };

      handle.addEventListener("mousedown", onDown);
      window.addEventListener("mousemove", onMove);
      window.addEventListener("mouseup", onUp);

      handle.addEventListener("touchstart", onDown, { passive:false });
      window.addEventListener("touchmove", onMove, { passive:false });
      window.addEventListener("touchend", onUp);
    })();

    // ---------- SVG helpers ----------
    function heartSvg(){
      return `
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 21s-7-4.35-9.5-8.28C.5 9.4 2.2 6.5 5.4 6.5c1.8 0 3.1 1 3.9 2 0 0 .9-2 3.8-2 3.2 0 4.9 2.9 2.9 6.22C19 16.65 12 21 12 21z"/>
        </svg>`;
    }
    function starSvg(){
      return `
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 17.3l-6.2 3.3 1.2-7-5-4.9 7-1L12 1.5l3 6.2 7 1-5 4.9 1.2 7z"/>
        </svg>`;
    }
    function checkSvg(){
      return `
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M20 6L9 17l-5-5"/>
        </svg>`;
    }
    function downloadSvg(){
      return `
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 3v12"/><path d="M7 10l5 5 5-5"/><path d="M5 21h14"/>
        </svg>`;
    }

    // ---------- Misc ----------
    function escapeHtml(s){
      return String(s)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }
    function escapeAttr(s){ return escapeHtml(s); }

    function cssEscape(s){
      // very small helper (enough for urls in attribute selector)
      return String(s).replaceAll('"','\\"').replaceAll("\\","\\\\");
    }

    function guessMime(url){
      const u = String(url||"").toLowerCase();
      if (u.includes(".mp3")) return "audio/mpeg";
      return "audio/mp4"; // m4a
    }

    // Start
    loadItems().catch(err=>{
      console.error(err);
      statusEl.textContent = "items.json y√ºklenemedi. Repo‚Äôda items.json var mƒ± ve aynƒ± dizinde mi?";
      countsEl.textContent = "G√∂r√ºnen: 0 / Toplam: 0";
    });
  </script>
</body>
</html>
